<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VR ë¦¬ë°¸ëŸ°ì‹± ë§¤ë‹ˆì €</title>
  <link rel="manifest" href="manifest.json">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js');
    }
  </script>
</head>
<body class="bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 text-white min-h-screen">
  <div id="app" class="max-w-6xl mx-auto p-4"></div>

  <script>
    function loadData() {
      const saved = localStorage.getItem('vr-portfolios-v2');
      if (saved) return JSON.parse(saved);
      return [{
        id: Date.now(),
        ticker: 'TQQQ',
        initialValue: 0,
        gValue: 100,
        currentPrice: 0,
        purchases: []
      }];
    }

    function saveData(data) {
      localStorage.setItem('vr-portfolios-v2', JSON.stringify(data));
    }

    let portfolios = loadData();
    let selectedIndex = 0;

    function getStats(p) {
      const totalShares = p.purchases.reduce((sum, r) => sum + r.shares, 0);
      const currentValue = totalShares * p.currentPrice;
      const currentCycle = p.purchases.length; 
      const targetValue = p.initialValue + (p.gValue * currentCycle);
      const diff = targetValue - currentValue;
      return { totalShares, currentValue, targetValue, currentCycle, diff };
    }

    function render() {
      const p = portfolios[selectedIndex];
      const stats = getStats(p);

      document.getElementById('app').innerHTML = `
        <header class="mb-8 pt-4 flex justify-between items-center">
          <div>
            <h1 class="text-3xl font-bold bg-gradient-to-r from-blue-400 to-cyan-400 bg-clip-text text-transparent">VR ë§¤ë‹ˆì €</h1>
            <p class="text-slate-400 text-sm">2ì£¼ ì£¼ê¸° ë¦¬ë°¸ëŸ°ì‹±</p>
          </div>
          <div class="flex gap-2">
            <button onclick="exportData()" class="px-2 py-1 bg-slate-700 rounded text-xs">ë°±ì—…</button>
            <button onclick="importData()" class="px-2 py-1 bg-slate-700 rounded text-xs">ë³µì›</button>
            <button onclick="addPortfolio()" class="px-3 py-1 bg-blue-600 rounded text-xs font-bold">+ ì¶”ê°€</button>
          </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
          <div class="lg:col-span-2 space-y-6">
            <div class="bg-slate-800/50 p-6 rounded-xl border border-slate-700">
              <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold">${p.ticker}</h2>
                <div class="flex gap-2 text-sm">
                   <input type="number" value="${p.currentPrice}" onchange="updatePrice(this.value)" class="w-20 bg-slate-900 border border-slate-700 rounded px-2">
                   <button onclick="fetchPrice('${p.ticker}')" class="bg-green-600 px-3 py-1 rounded text-xs">ì‹œì„¸ì¡°íšŒ</button>
                </div>
              </div>

              <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="bg-slate-900 p-4 rounded-lg">
                  <p class="text-slate-500 text-xs mb-1">ì‹œì‘ ë°¸ë¥˜($V_0$)</p>
                  <input type="number" value="${p.initialValue}" onchange="updateInitialValue(this.value)" class="w-full bg-transparent text-xl font-bold focus:outline-none">
                </div>
                <div class="bg-slate-900 p-4 rounded-lg">
                  <p class="text-slate-500 text-xs mb-1">Gê°’ (2ì£¼ ì¦ê°€ë¶„)</p>
                  <input type="number" value="${p.gValue}" onchange="updateGValue(this.value)" class="w-full bg-transparent text-xl font-bold text-amber-400 focus:outline-none">
                </div>
                <div class="bg-slate-900 p-4 rounded-lg text-center">
                  <p class="text-slate-500 text-xs mb-1">í˜„ì¬ ì‚¬ì´í´</p>
                  <p class="text-xl font-bold">${stats.currentCycle}íšŒ ì™„ë£Œ</p>
                </div>
              </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div class="bg-slate-800/50 p-6 rounded-xl border border-slate-700 text-center">
                <p class="text-slate-500 text-sm mb-1">ëª©í‘œ ë°¸ë¥˜(TV)</p>
                <p class="text-3xl font-black text-cyan-400">$ ${stats.targetValue.toLocaleString()}</p>
              </div>
              <div class="bg-slate-800/50 p-6 rounded-xl border border-slate-700 text-center">
                <p class="text-slate-500 text-sm mb-1">í˜„ì¬ ë°¸ë¥˜(CV)</p>
                <p class="text-3xl font-black text-blue-400">$ ${stats.currentValue.toLocaleString(undefined, {maximumFractionDigits:0})}</p>
              </div>
            </div>

            <div class="bg-blue-900/30 p-6 rounded-xl border border-blue-700">
              <h3 class="font-bold text-blue-300 mb-2 font-sm">ğŸ“¢ ë‹¤ìŒ í–‰ë™ ì§€ì¹¨</h3>
              <p class="text-lg">
                ì´ë²ˆ ì£¼ê¸°(2ì£¼)ì— <span class="font-bold ${stats.diff > 0 ? 'text-cyan-400' : 'text-red-400'}">
                $${Math.abs(stats.diff).toLocaleString(undefined, {maximumFractionDigits:0})}</span>ë§Œí¼ 
                ${stats.diff > 0 ? '<span class="underline">ë§¤ìˆ˜</span>' : '<span class="underline">ë§¤ë„</span>'}í•˜ì„¸ìš”.
              </p>
            </div>
          </div>

          <div class="bg-slate-800/50 p-6 rounded-xl border border-slate-700">
            <h3 class="font-bold mb-4">ì‚¬ì´í´ ê¸°ë¡ í™•ì •</h3>
            <div class="space-y-4">
              <input type="number" id="buyPrice" value="${p.currentPrice}" placeholder="ë‹¨ê°€($)" class="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-2">
              <input type="number" id="buyShares" placeholder="ìˆ˜ëŸ‰(ë§¤ë„ ì‹œ ë§ˆì´ë„ˆìŠ¤)" class="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-2">
              <button onclick="addRecord()" class="w-full bg-blue-600 py-3 rounded-lg font-bold">ê¸°ë¡ ì¶”ê°€ (1ì‚¬ì´í´ ì¦ê°€)</button>
              <div class="pt-4 border-t border-slate-700 text-sm">
                <p class="flex justify-between text-slate-400"><span>ë³´ìœ  ìˆ˜ëŸ‰:</span> <span class="text-white">${stats.totalShares.toFixed(2)} ì£¼</span></p>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function updateInitialValue(v) { portfolios[selectedIndex].initialValue = parseFloat(v); saveData(portfolios); render(); }
    function updateGValue(v) { portfolios[selectedIndex].gValue = parseFloat(v); saveData(portfolios); render(); }
    function updatePrice(v) { portfolios[selectedIndex].currentPrice = parseFloat(v); saveData(portfolios); render(); }
    function addRecord() {
      const p = parseFloat(document.getElementById('buyPrice').value);
      const s = parseFloat(document.getElementById('buyShares').value);
      if(isNaN(p) || isNaN(s)) return;
      portfolios[selectedIndex].purchases.push({ date: new Date().toISOString(), price: p, shares: s });
      saveData(portfolios); render();
    }
    async function fetchPrice(ticker) {
      try {
        const res = await fetch(`https://query1.finance.yahoo.com/v8/finance/chart/${ticker}?interval=1m&range=1d`);
        const data = await res.json();
        portfolios[selectedIndex].currentPrice = data.chart.result[0].meta.regularMarketPrice;
        saveData(portfolios); render();
      } catch (e) { alert('ì¡°íšŒ ì‹¤íŒ¨'); }
    }
    function exportData() { const blob = new Blob([JSON.stringify(portfolios)], {type:'application/json'}); const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'vr-data.json'; a.click(); }
    function importData() { const i = document.createElement('input'); i.type = 'file'; i.onchange = (e) => { const r = new FileReader(); r.onload = (ev) => { portfolios = JSON.parse(ev.target.result); saveData(portfolios); render(); }; r.readAsText(e.target.files[0]); }; i.click(); }
    function addPortfolio() { const t = prompt('í‹°ì»¤?'); if(t) { portfolios.push({ id: Date.now(), ticker: t.toUpperCase(), initialValue: 0, gValue: 100, currentPrice: 0, purchases: [] }); selectedIndex = portfolios.length - 1; saveData(portfolios); render(); } }

    render();
  </script>
</body>
</html>
